var e=Object.defineProperty,t=Object.defineProperties,r=Object.getOwnPropertyDescriptors,n=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable,a=(t,r,n)=>r in t?e(t,r,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[r]=n;let i,c;const u=new WeakMap,d=new WeakMap,l=new WeakMap,p=new WeakMap,f=new WeakMap;let v={get(e,t,r){if(e instanceof IDBTransaction){if("done"===t)return d.get(e);if("objectStoreNames"===t)return e.objectStoreNames||l.get(e);if("store"===t)return r.objectStoreNames[1]?void 0:r.objectStore(r.objectStoreNames[0])}return m(e[t])},set:(e,t,r)=>(e[t]=r,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function b(e){return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(c||(c=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(D(this),t),m(u.get(this))}:function(...t){return m(e.apply(D(this),t))}:function(t,...r){const n=e.call(D(this),t,...r);return l.set(n,t.sort?t.sort():[t]),m(n)}}function y(e){return"function"==typeof e?b(e):(e instanceof IDBTransaction&&function(e){if(d.has(e))return;const t=new Promise((t,r)=>{const n=()=>{e.removeEventListener("complete",o),e.removeEventListener("error",s),e.removeEventListener("abort",s)},o=()=>{t(),n()},s=()=>{r(e.error||new DOMException("AbortError","AbortError")),n()};e.addEventListener("complete",o),e.addEventListener("error",s),e.addEventListener("abort",s)});d.set(e,t)}(e),t=e,(i||(i=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some(e=>t instanceof e)?new Proxy(e,v):e);var t}function m(e){if(e instanceof IDBRequest)return function(e){const t=new Promise((t,r)=>{const n=()=>{e.removeEventListener("success",o),e.removeEventListener("error",s)},o=()=>{t(m(e.result)),n()},s=()=>{r(e.error),n()};e.addEventListener("success",o),e.addEventListener("error",s)});return t.then(t=>{t instanceof IDBCursor&&u.set(t,e)}).catch(()=>{}),f.set(t,e),t}(e);if(p.has(e))return p.get(e);const t=y(e);return t!==e&&(p.set(e,t),f.set(t,e)),t}const D=e=>f.get(e);function g(e,t,{blocked:r,upgrade:n,blocking:o,terminated:s}={}){const a=indexedDB.open(e,t),i=m(a);return n&&a.addEventListener("upgradeneeded",e=>{n(m(a.result),e.oldVersion,e.newVersion,m(a.transaction),e)}),r&&a.addEventListener("blocked",e=>r(e.oldVersion,e.newVersion,e)),i.then(e=>{s&&e.addEventListener("close",()=>s()),o&&e.addEventListener("versionchange",e=>o(e.oldVersion,e.newVersion,e))}).catch(()=>{}),i}const h=["get","getKey","getAll","getAllKeys","count"],I=["put","add","delete","clear"],w=new Map;function B(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!=typeof t)return;if(w.get(t))return w.get(t);const r=t.replace(/FromIndex$/,""),n=t!==r,o=I.includes(r);if(!(r in(n?IDBIndex:IDBObjectStore).prototype)||!o&&!h.includes(r))return;const s=function(e,...t){return s=this,a=null,i=function*(){const s=this.transaction(e,o?"readwrite":"readonly");let a=s.store;return n&&(a=a.index(t.shift())),(yield Promise.all([a[r](...t),o&&s.done]))[0]},new Promise((e,t)=>{var r=e=>{try{o(i.next(e))}catch(r){t(r)}},n=e=>{try{o(i.throw(e))}catch(r){t(r)}},o=t=>t.done?e(t.value):Promise.resolve(t.value).then(r,n);o((i=i.apply(s,a)).next())});var s,a,i};return w.set(t,s),s}v=(e=>{return i=((e,t)=>{for(var r in t||(t={}))o.call(t,r)&&a(e,r,t[r]);if(n)for(var r of n(t))s.call(t,r)&&a(e,r,t[r]);return e})({},e),t(i,r({get:(t,r,n)=>B(t,r)||e.get(t,r,n),has:(t,r)=>!!B(t,r)||e.has(t,r)}));var i})(v);export{g as o};