# Security and Data

## Секреты и конфигурация

- **Firebase:** Конфигурация приложения задаётся переменными окружения с префиксом `VITE_*` (см. README и `src/lib/firebase.ts`):  
  `VITE_FIREBASE_API_KEY`, `VITE_FIREBASE_AUTH_DOMAIN`, `VITE_FIREBASE_PROJECT_ID`, `VITE_FIREBASE_STORAGE_BUCKET`, `VITE_FIREBASE_MESSAGING_SENDER_ID`, `VITE_FIREBASE_APP_ID`, `VITE_FIREBASE_MEASUREMENT_ID`.  
  Файл `.env` не коммитится; пример — `.env.example`.
- **Внешние API:** Погода — `VITE_OPENWEATHER_API_KEY` (см. `src/lib/services/weather.ts`). При отсутствии ключа в dev выводится предупреждение; виджет погоды может не работать.
- **E2E/визуальные тесты:** Учётные данные тестового пользователя — через `TEST_USER_EMAIL`, `TEST_USER_PASSWORD` (или `TEST_EMAIL`, `TEST_PASSWORD` в визуальных тестах). Не коммитить реальные пароли; в CI задавать через секреты.

## Firebase Security Rules

- Доступ к данным Firestore должен быть ограничен правилами Firebase (Firestore Security Rules): только аутентифицированный пользователь имеет доступ к своим документам (например, `users/{userId}/...` только для `request.auth.uid === userId`). Правила настраиваются в консоли Firebase и не хранятся в этом репозитории; при развёртывании проекта необходимо убедиться, что правила включены и актуальны.
- **Допущение:** В проекте предполагается, что правила уже настроены для ORDINA 1 и применяются к тому же Firestore; при создании нового проекта правила нужно настроить вручную.

## Статус интеграций

- **Firebase и внешние API:** логика и схема данных совпадают с ORDINA 1 и в этом репозитории не меняются без отдельного согласования.

## Персональные и чувствительные данные

- **Аутентификация:** Firebase Auth; данные профиля (email, displayName, photoURL) хранятся в Auth и при необходимости в `userStore` на клиенте. Пароли не хранятся в приложении.
- **Данные пользователя:** Расходы, долги, задачи, события календаря хранятся в Firestore в путях, привязанных к `userId`. Трафик между клиентом и Firebase шифруется (HTTPS). Локально в браузере могут кэшироваться данные и состояние (localStorage: тема, язык, валюта, курс, даты carry-over).
- **Экспорт:** CSV-экспорт генерируется на клиенте из данных stores; файл сохраняется на устройство пользователя. Не передаётся на сторонние серверы приложения.

## Офлайн и кэш

- Service Worker (`public/sw.js`) кэширует статику и при необходимости запросы для офлайн-работы. Данные Firestore в офлайн-режиме зависят от кэша Firestore SDK и настроек persistence. Очередь записей при отсутствии сети обрабатывается Firebase SDK; при восстановлении связи данные синхронизируются с Firestore. Не хранить в кэше чувствительные данные в незашифрованном виде сверх того, что уже хранит Firebase.

## Рекомендации

- Не добавлять в репозиторий файлы `.env` с реальными ключами.
- Не хардкодить API-ключи в коде; использовать переменные окружения.
- При добавлении новых внешних API выносить ключи в env и документировать в README или этом документе.
- Регулярно проверять актуальность Firebase Security Rules и политик доступа при изменении структуры коллекций.

Дополнительно: `Technical_Architecture.md` (Firebase), `User_Guide.md` (офлайн), `Skeleton.md` (правила по данным).
