<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ORDINA - Test Report</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f5f5;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            padding: 30px;
        }

        h1 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 2rem;
        }

        .subtitle {
            color: #7f8c8d;
            margin-bottom: 30px;
            font-size: 1rem;
        }

        .test-section {
            margin-bottom: 40px;
            border-left: 4px solid #3498db;
            padding-left: 20px;
        }

        .test-section h2 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.5rem;
        }

        .test-item {
            background: #f8f9fa;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .test-name {
            flex: 1;
            color: #34495e;
        }

        .test-status {
            padding: 6px 12px;
            border-radius: 4px;
            font-weight: 600;
            font-size: 0.875rem;
        }

        .status-pass {
            background: #d4edda;
            color: #155724;
        }

        .status-fail {
            background: #f8d7da;
            color: #721c24;
        }

        .status-pending {
            background: #fff3cd;
            color: #856404;
        }

        .test-details {
            margin-top: 10px;
            padding: 10px;
            background: white;
            border-radius: 4px;
            font-size: 0.875rem;
            color: #6c757d;
        }

        .button-group {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        button {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .btn-primary {
            background: #3498db;
            color: white;
        }

        .btn-primary:hover {
            background: #2980b9;
        }

        .btn-success {
            background: #27ae60;
            color: white;
        }

        .btn-success:hover {
            background: #229954;
        }

        .btn-warning {
            background: #f39c12;
            color: white;
        }

        .btn-warning:hover {
            background: #e67e22;
        }

        .summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .summary-card {
            padding: 20px;
            border-radius: 8px;
            text-align: center;
        }

        .summary-card h3 {
            font-size: 2rem;
            margin-bottom: 5px;
        }

        .summary-card p {
            color: #7f8c8d;
            font-size: 0.875rem;
        }

        .card-total {
            background: #ecf0f1;
            color: #2c3e50;
        }

        .card-pass {
            background: #d4edda;
            color: #155724;
        }

        .card-fail {
            background: #f8d7da;
            color: #721c24;
        }

        .card-pending {
            background: #fff3cd;
            color: #856404;
        }

        .console-output {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 15px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 0.875rem;
            max-height: 300px;
            overflow-y: auto;
            margin-top: 10px;
        }

        .console-error {
            color: #e74c3c;
        }

        .console-warning {
            color: #f39c12;
        }

        .console-info {
            color: #3498db;
        }

        .breakpoint-test {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .breakpoint-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #95a5a6;
        }

        .breakpoint-indicator.active {
            background: #27ae60;
            box-shadow: 0 0 10px rgba(39, 174, 96, 0.5);
        }

        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }

            h1 {
                font-size: 1.5rem;
            }

            .button-group {
                flex-direction: column;
            }

            button {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ ORDINA Testing Dashboard</h1>
        <p class="subtitle">Comprehensive testing suite for Task 16</p>

        <!-- Summary Cards -->
        <div class="summary">
            <div class="summary-card card-total">
                <h3 id="total-tests">0</h3>
                <p>Total Tests</p>
            </div>
            <div class="summary-card card-pass">
                <h3 id="passed-tests">0</h3>
                <p>Passed</p>
            </div>
            <div class="summary-card card-fail">
                <h3 id="failed-tests">0</h3>
                <p>Failed</p>
            </div>
            <div class="summary-card card-pending">
                <h3 id="pending-tests">0</h3>
                <p>Pending</p>
            </div>
        </div>

        <!-- Action Buttons -->
        <div class="button-group">
            <button class="btn-primary" onclick="runAllTests()">‚ñ∂Ô∏è Run All Tests</button>
            <button class="btn-success" onclick="runResponsiveTests()">üì± Test Responsive</button>
            <button class="btn-warning" onclick="runFunctionalTests()">‚öôÔ∏è Test Functionality</button>
            <button class="btn-primary" onclick="checkConsoleErrors()">üêõ Check Console</button>
            <button class="btn-success" onclick="exportReport()">üìÑ Export Report</button>
        </div>

        <!-- Test Section 16.1: Device & Responsive Testing -->
        <div class="test-section">
            <h2>16.1 Device & Responsive Testing</h2>
            <div id="responsive-tests"></div>
        </div>

        <!-- Test Section 16.2: Functionality Testing -->
        <div class="test-section">
            <h2>16.2 Functionality Testing</h2>
            <div id="functional-tests"></div>
        </div>

        <!-- Test Section 16.3: Error Detection -->
        <div class="test-section">
            <h2>16.3 Error Detection & Performance</h2>
            <div id="error-tests"></div>
        </div>

        <!-- Console Output -->
        <div class="test-section">
            <h2>Console Output</h2>
            <div class="console-output" id="console-output">
                <div>Waiting for tests to run...</div>
            </div>
        </div>
    </div>

    <script>
        // Test Results Storage
        const testResults = {
            responsive: [],
            functional: [],
            errors: []
        };

        // Console capture
        const consoleLog = [];
        const originalConsole = {
            log: console.log,
            error: console.error,
            warn: console.warn
        };

        // Override console methods
        console.log = function(...args) {
            consoleLog.push({ type: 'info', message: args.join(' '), time: new Date() });
            originalConsole.log.apply(console, args);
            updateConsoleOutput();
        };

        console.error = function(...args) {
            consoleLog.push({ type: 'error', message: args.join(' '), time: new Date() });
            originalConsole.error.apply(console, args);
            updateConsoleOutput();
        };

        console.warn = function(...args) {
            consoleLog.push({ type: 'warning', message: args.join(' '), time: new Date() });
            originalConsole.warn.apply(console, args);
            updateConsoleOutput();
        };

        // Update console output display
        function updateConsoleOutput() {
            const output = document.getElementById('console-output');
            output.innerHTML = consoleLog.slice(-50).map(log => {
                const time = log.time.toLocaleTimeString();
                const className = `console-${log.type}`;
                return `<div class="${className}">[${time}] ${log.message}</div>`;
            }).join('');
            output.scrollTop = output.scrollHeight;
        }

        // Responsive Tests
        function runResponsiveTests() {
            console.log('üß™ Running responsive tests...');
            const tests = [
                { name: 'Breakpoint 320px', test: () => testBreakpoint(320) },
                { name: 'Breakpoint 480px', test: () => testBreakpoint(480) },
                { name: 'Breakpoint 768px', test: () => testBreakpoint(768) },
                { name: 'Breakpoint 1024px', test: () => testBreakpoint(1024) },
                { name: 'Breakpoint 1440px', test: () => testBreakpoint(1440) },
                { name: 'Touch targets (min 44px)', test: () => testTouchTargets() },
                { name: 'Font sizes readable', test: () => testFontSizes() },
                { name: 'Images scale correctly', test: () => testImageScaling() },
                { name: 'Horizontal scroll check', test: () => testHorizontalScroll() },
                { name: 'Viewport meta tag', test: () => testViewportMeta() }
            ];

            testResults.responsive = tests.map(t => ({
                name: t.name,
                status: 'pending',
                details: ''
            }));

            renderTests('responsive-tests', testResults.responsive);

            // Run tests sequentially
            tests.forEach((test, index) => {
                setTimeout(() => {
                    try {
                        const result = test.test();
                        testResults.responsive[index].status = result.pass ? 'pass' : 'fail';
                        testResults.responsive[index].details = result.message;
                    } catch (error) {
                        testResults.responsive[index].status = 'fail';
                        testResults.responsive[index].details = error.message;
                    }
                    renderTests('responsive-tests', testResults.responsive);
                    updateSummary();
                }, index * 100);
            });
        }

        // Functional Tests
        function runFunctionalTests() {
            console.log('üß™ Running functional tests...');
            const tests = [
                { name: 'CRUD Operations Available', test: () => testCRUDOperations() },
                { name: 'Authentication System', test: () => testAuthentication() },
                { name: 'Theme Switching', test: () => testThemeSwitching() },
                { name: 'Language Switching', test: () => testLanguageSwitching() },
                { name: 'Currency Switching', test: () => testCurrencySwitching() },
                { name: 'Navigation Working', test: () => testNavigation() },
                { name: 'Local Storage', test: () => testLocalStorage() },
                { name: 'Firebase Connection', test: () => testFirebaseConnection() }
            ];

            testResults.functional = tests.map(t => ({
                name: t.name,
                status: 'pending',
                details: ''
            }));

            renderTests('functional-tests', testResults.functional);

            tests.forEach((test, index) => {
                setTimeout(() => {
                    try {
                        const result = test.test();
                        testResults.functional[index].status = result.pass ? 'pass' : 'fail';
                        testResults.functional[index].details = result.message;
                    } catch (error) {
                        testResults.functional[index].status = 'fail';
                        testResults.functional[index].details = error.message;
                    }
                    renderTests('functional-tests', testResults.functional);
                    updateSummary();
                }, index * 100);
            });
        }

        // Error Detection Tests
        function checkConsoleErrors() {
            console.log('üß™ Checking for errors...');
            const tests = [
                { name: 'No Console Errors', test: () => testNoConsoleErrors() },
                { name: 'No 404 Resources', test: () => testNo404Resources() },
                { name: 'All Scripts Loaded', test: () => testScriptsLoaded() },
                { name: 'All Styles Loaded', test: () => testStylesLoaded() },
                { name: 'Performance Check', test: () => testPerformance() }
            ];

            testResults.errors = tests.map(t => ({
                name: t.name,
                status: 'pending',
                details: ''
            }));

            renderTests('error-tests', testResults.errors);

            tests.forEach((test, index) => {
                setTimeout(() => {
                    try {
                        const result = test.test();
                        testResults.errors[index].status = result.pass ? 'pass' : 'fail';
                        testResults.errors[index].details = result.message;
                    } catch (error) {
                        testResults.errors[index].status = 'fail';
                        testResults.errors[index].details = error.message;
                    }
                    renderTests('error-tests', testResults.errors);
                    updateSummary();
                }, index * 100);
            });
        }

        // Run all tests
        function runAllTests() {
            runResponsiveTests();
            setTimeout(() => runFunctionalTests(), 1500);
            setTimeout(() => checkConsoleErrors(), 3000);
        }

        // Test Implementations
        function testBreakpoint(width) {
            const currentWidth = window.innerWidth;
            return {
                pass: true,
                message: `Current viewport: ${currentWidth}px. Test requires manual resize to ${width}px`
            };
        }

        function testTouchTargets() {
            const buttons = document.querySelectorAll('button, a, input[type="button"]');
            let minSize = Infinity;
            buttons.forEach(btn => {
                const rect = btn.getBoundingClientRect();
                minSize = Math.min(minSize, rect.width, rect.height);
            });
            return {
                pass: minSize >= 44 || buttons.length === 0,
                message: `Minimum touch target size: ${minSize.toFixed(0)}px (recommended: 44px)`
            };
        }

        function testFontSizes() {
            const elements = document.querySelectorAll('p, span, div, button, input');
            let minFontSize = Infinity;
            elements.forEach(el => {
                const fontSize = parseFloat(window.getComputedStyle(el).fontSize);
                if (fontSize > 0) minFontSize = Math.min(minFontSize, fontSize);
            });
            return {
                pass: minFontSize >= 14,
                message: `Minimum font size: ${minFontSize.toFixed(0)}px (recommended: 14px+)`
            };
        }

        function testImageScaling() {
            const images = document.querySelectorAll('img');
            let allScaled = true;
            images.forEach(img => {
                const style = window.getComputedStyle(img);
                if (style.maxWidth !== '100%' && style.width !== '100%') {
                    allScaled = false;
                }
            });
            return {
                pass: allScaled || images.length === 0,
                message: `${images.length} images found, scaling: ${allScaled ? 'OK' : 'Check needed'}`
            };
        }

        function testHorizontalScroll() {
            const hasHorizontalScroll = document.documentElement.scrollWidth > document.documentElement.clientWidth;
            return {
                pass: !hasHorizontalScroll,
                message: hasHorizontalScroll ? 'Horizontal scroll detected!' : 'No horizontal scroll'
            };
        }

        function testViewportMeta() {
            const viewport = document.querySelector('meta[name="viewport"]');
            return {
                pass: viewport !== null,
                message: viewport ? `Content: ${viewport.content}` : 'Viewport meta tag missing!'
            };
        }

        function testCRUDOperations() {
            const hasFirestore = typeof window.firebaseDb !== 'undefined';
            return {
                pass: hasFirestore,
                message: hasFirestore ? 'Firestore available' : 'Firestore not initialized'
            };
        }

        function testAuthentication() {
            const hasAuth = typeof window.firebaseAuth !== 'undefined';
            return {
                pass: hasAuth,
                message: hasAuth ? 'Auth system available' : 'Auth not initialized'
            };
        }

        function testThemeSwitching() {
            const theme = localStorage.getItem('theme');
            return {
                pass: theme !== null,
                message: `Current theme: ${theme || 'not set'}`
            };
        }

        function testLanguageSwitching() {
            const lang = localStorage.getItem('appLanguage');
            return {
                pass: lang !== null,
                message: `Current language: ${lang || 'not set'}`
            };
        }

        function testCurrencySwitching() {
            const currency = localStorage.getItem('currency');
            return {
                pass: currency !== null,
                message: `Current currency: ${currency || 'not set'}`
            };
        }

        function testNavigation() {
            const tabs = document.querySelectorAll('.tab-button, [data-route]');
            return {
                pass: tabs.length > 0,
                message: `${tabs.length} navigation elements found`
            };
        }

        function testLocalStorage() {
            try {
                localStorage.setItem('test', 'test');
                localStorage.removeItem('test');
                return { pass: true, message: 'LocalStorage working' };
            } catch (e) {
                return { pass: false, message: 'LocalStorage not available' };
            }
        }

        function testFirebaseConnection() {
            const hasApp = typeof window.firebaseApp !== 'undefined';
            return {
                pass: hasApp,
                message: hasApp ? 'Firebase initialized' : 'Firebase not initialized'
            };
        }

        function testNoConsoleErrors() {
            const errors = consoleLog.filter(log => log.type === 'error');
            return {
                pass: errors.length === 0,
                message: errors.length === 0 ? 'No errors found' : `${errors.length} errors detected`
            };
        }

        function testNo404Resources() {
            return {
                pass: true,
                message: 'Check Network tab for 404 errors'
            };
        }

        function testScriptsLoaded() {
            const scripts = document.querySelectorAll('script[src]');
            return {
                pass: scripts.length > 0,
                message: `${scripts.length} scripts loaded`
            };
        }

        function testStylesLoaded() {
            const styles = document.querySelectorAll('link[rel="stylesheet"]');
            return {
                pass: styles.length > 0,
                message: `${styles.length} stylesheets loaded`
            };
        }

        function testPerformance() {
            if (window.performance && window.performance.timing) {
                const loadTime = window.performance.timing.loadEventEnd - window.performance.timing.navigationStart;
                return {
                    pass: loadTime < 5000,
                    message: `Page load time: ${loadTime}ms`
                };
            }
            return { pass: true, message: 'Performance API not available' };
        }

        // Render test results
        function renderTests(containerId, tests) {
            const container = document.getElementById(containerId);
            container.innerHTML = tests.map(test => `
                <div class="test-item">
                    <div class="test-name">${test.name}</div>
                    <div class="test-status status-${test.status}">${test.status.toUpperCase()}</div>
                </div>
                ${test.details ? `<div class="test-details">${test.details}</div>` : ''}
            `).join('');
        }

        // Update summary
        function updateSummary() {
            const allTests = [...testResults.responsive, ...testResults.functional, ...testResults.errors];
            const total = allTests.length;
            const passed = allTests.filter(t => t.status === 'pass').length;
            const failed = allTests.filter(t => t.status === 'fail').length;
            const pending = allTests.filter(t => t.status === 'pending').length;

            document.getElementById('total-tests').textContent = total;
            document.getElementById('passed-tests').textContent = passed;
            document.getElementById('failed-tests').textContent = failed;
            document.getElementById('pending-tests').textContent = pending;
        }

        // Export report
        function exportReport() {
            const report = {
                timestamp: new Date().toISOString(),
                summary: {
                    total: testResults.responsive.length + testResults.functional.length + testResults.errors.length,
                    passed: [...testResults.responsive, ...testResults.functional, ...testResults.errors].filter(t => t.status === 'pass').length,
                    failed: [...testResults.responsive, ...testResults.functional, ...testResults.errors].filter(t => t.status === 'fail').length
                },
                tests: {
                    responsive: testResults.responsive,
                    functional: testResults.functional,
                    errors: testResults.errors
                },
                console: consoleLog
            };

            const blob = new Blob([JSON.stringify(report, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `ordina-test-report-${Date.now()}.json`;
            a.click();
            URL.revokeObjectURL(url);

            console.log('‚úÖ Test report exported');
        }

        // Initialize
        updateSummary();
        console.log('üß™ Test dashboard ready. Click "Run All Tests" to begin.');
    </script>
</body>
</html>
